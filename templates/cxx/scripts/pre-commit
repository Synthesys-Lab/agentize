#!/bin/bash

# Pre-commit hook to run tests before committing
# This ensures code quality by running all test suites

set -e

# Get the repository root directory
REPO_ROOT="$(git rev-parse --show-toplevel)"

# Run documentation linter first (skip if not available)
if [ -f "$REPO_ROOT/scripts/lint-documentation.sh" ]; then
    echo "Running documentation linter..."
    if ! "$REPO_ROOT/scripts/lint-documentation.sh"; then
        echo ""
        echo "❌ Documentation linting failed! Commit aborted."
        echo "Fix missing documentation or use --no-verify for milestone commits."
        exit 1
    fi
else
    echo "Skipping documentation linter (script not found)"
fi

echo ""
echo "Running pre-commit tests..."
echo ""

# Run the test-all.sh script (skip if not available)
if [ -f "$REPO_ROOT/tests/test-all.sh" ]; then
    if ! "$REPO_ROOT/tests/test-all.sh"; then
        echo ""
        echo "❌ Tests failed! Commit aborted."
        echo "Please fix the failing tests before committing."
        exit 1
    fi
else
    echo "Skipping tests (test-all.sh not found)"
fi

echo ""
echo "✅ All checks passed! Proceeding with commit."
exit 0
